<% title="Login - Zendo Admin" %>

    <div class="flex min-h-screen w-screen flex-col items-center justify-center sm:bg-gray-50 p-4">

        <div class="w-full max-w-md rounded-none shadow-none border-none sm:rounded-lg sm:shadow-lg bg-white">
            <div class="text-center p-6">
                <img src="/images/logo.png" alt="zendo-logo" class="mx-auto mb-2 h-16 w-16 rounded-full" />
                <h2 class="text-2xl font-semibold">Welcome Back</h2>
                <p class="text-gray-600">Please sign in to continue</p>
            </div>

            <div class="p-6 pt-0">
                <form id="loginForm" class="space-y-4">
                    <input id="email" type="email" placeholder="Email ID" required
                        class="w-full px-3 py-2 mt-1 rounded border border-gray-300 shadow-none focus:outline-none" />

                    <div class="relative">
                        <input id="password" type="password" placeholder="Password" required
                            class="w-full px-3 py-2 mt-1 rounded border border-gray-300 pr-10" />
                        <button type="button" id="togglePassword"
                            class="absolute inset-y-0 right-0 px-3 text-sm text-gray-500">üëÅÔ∏è</button>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="rememberMe"
                            class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded" />
                        <label for="rememberMe" class="text-sm text-gray-700">Remember me</label>
                    </div>

                    <div id="errorMessage" class="text-sm text-red-500 hidden"></div>

                    <button type="submit" id="submitBtn"
                        class="w-full py-2 bg-black text-white rounded hover:bg-gray-900">
                        Login
                    </button>
                </form>

                <div class="w-full flex justify-end mt-2">
                    <a href="/auth/forgot-password" class="text-sm text-blue-500 hover:underline">Forgot password?</a>
                </div>
            </div>
        </div>

        <script>
            const form = document.getElementById('loginForm');
            const errorMessage = document.getElementById('errorMessage');
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const submitBtn = document.getElementById('submitBtn');

            togglePassword.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            });

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                errorMessage.classList.add('hidden');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Logging in...';

                const email = document.getElementById('email').value;
                const password = passwordInput.value;
                const rememberMe = document.getElementById('rememberMe').checked;

                try {
                    const res = await fetch('https://zondo.brancosoft.ae/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password, fcm_token: '' })
                    });

                    const data = await res.json();

                    if (data.status_code === 200) {
                        if (!data.data.is_admin) {
                            throw new Error('Cannot login without an admin account.');
                        }

                        const token = data.data.token;
                        const refreshToken = data.data.refresh_token;

                        if (rememberMe) {
                            localStorage.setItem('zendo_at', token);
                            localStorage.setItem('zendo_rt', refreshToken);
                        } else {
                            sessionStorage.setItem('zendo_at', token);
                            sessionStorage.setItem('zendo_rt', refreshToken);
                        }

                        window.location.href = '/';
                    } else {
                        throw new Error(data.message || 'Login failed');
                    }

                } catch (err) {
                    errorMessage.textContent = err.message;
                    errorMessage.classList.remove('hidden');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Login';
                }
            });
        </script>
    </div>